{%- block toggle_password_widget -%}
  {#
    Template for password field with visibility toggle

    Available variables:
    - toggle: Enable/disable toggle functionality (default: true)
    - visible_label: Label when password is hidden (default: "Show")
    - hidden_label: Label when password is visible (default: "Hide")
    - visible_icon: UX icon when password is hidden (default: "tabler:eye-off")
    - hidden_icon: UX icon when password is visible (default: "tabler:eye")
    - toggle_container_classes: CSS classes for the container
    - button_classes: CSS classes for the toggle button

    NATIVE TOGGLE: Uses inline onclick to avoid conflicts with LiveComponent
    Does NOT use Stimulus - Pure JavaScript for maximum compatibility
  #}

  {%- set toggle_enabled = toggle ?? true -%}
  {%- set type = type|default('password') -%}

  {%- if toggle_enabled -%}
    <div class="input-group input-group-merge form-password-toggle {{ (toggle_container_classes ?? [])|join(' ') }}">
      <input type="{{ type }}" {{ block('widget_attributes') }} {% if value is not empty %}value="{{ value }}" {% endif %}/>
      <span class="{{ (button_classes ?? ['input-group-text', 'cursor-pointer'])|join(' ') }}"
            role="button"
            tabindex="0"
            aria-label="{{ visible_label|default('Show password') }}"
            onclick="
              const input = this.previousElementSibling;
              const iconHidden = this.querySelector('.icon-hidden');
              const iconVisible = this.querySelector('.icon-visible');

              if (input && input.type === 'password') {
                input.type = 'text';
                if (iconHidden) iconHidden.classList.add('d-none');
                if (iconVisible) iconVisible.classList.remove('d-none');
                this.setAttribute('aria-label', '{{ hidden_label|default('Hide password') }}');
              } else if (input) {
                input.type = 'password';
                if (iconHidden) iconHidden.classList.remove('d-none');
                if (iconVisible) iconVisible.classList.add('d-none');
                this.setAttribute('aria-label', '{{ visible_label|default('Show password') }}');
              }
            "
            onkeydown="
              if (event.key === 'Enter' || event.key === ' ') {
                event.preventDefault();
                this.click();
              }
            ">
        {%- if visible_icon is defined and visible_icon -%}
          {{ ux_icon(visible_icon|default('tabler:eye-off'), {class: 'icon-hidden icon-base ti tabler'}) }}
        {%- endif -%}
        {%- if hidden_icon is defined and hidden_icon -%}
          {{ ux_icon(hidden_icon|default('tabler:eye'), {class: 'icon-visible d-none icon-base ti tabler'}) }}
        {%- endif -%}
      </span>
    </div>
  {%- else -%}
    {# Render simple password input when toggle is disabled #}
    <input type="{{ type }}" {{ block('widget_attributes') }} {% if value is not empty %}value="{{ value }}" {% endif %}/>
  {%- endif -%}
{%- endblock toggle_password_widget -%}

